# ODB设计文档

**10.05创建**(先前那份已经过时)

## Orange协议(简单实现)

格式：

```c
4byte	:	行1\n	行2\n
%4d
确定行数(换行符个数)
```

参数：

最大行数：9999行

每行最大字节数：512B

包最大大小：约5MB

行分隔符：\n



收发数据：

若是数据不以\n结尾，无效；

若是数据换行符少于开头规定个数，无效；

接收成功返回\t，否则重复发送至成功



## Server

------

### src

#### server：服务端主文件

包含run_server函数与请求处理函数。

### ORP(orange协议)

#### ORPSET：传输配置

#### command：命令解析器

包括命令解析的核心函数：

splitCommand()：用于将命令切分为方法和带括号参数行两部分

getCommandType()：用于获取方法对应的枚举值

splitParams()：用于将带括号参数行进一步切分，输出所有参数

command_check()：调用上面的函数对命令进行语法检查

#### affair：初步处理事务



### resource(资源存放文件夹)

#### config：一般配置文件

定义IP、端口、默认快照路径等配置信息

#### .odb：快照文件



### build(CMake默认输出文件夹)



### data(命令实现)

#### Realizer：命令实现总接口

包含所有命令的枚举定义，实现函数

#### Hash：根本存储模块

定义了特殊形式的存储专用哈希表及相关API

#### autoSaver：自动保存线程

定义了跟踪数据变化数、控制自动保存线程开关的外部变量，以及操作这些外部变量的线程安全的函数。

包含自动保存线程的创建函数、线程函数。

#### list：列表类型值接口

包含列表的格式化与解析函数

#### valueHash：哈希类型值接口

包含普通哈希表API，格式化与解析函数

#### set：集合类型值接口

#### SDS：SDS类型API

#### DLinkList：双向链表API

### 

## Client

------

### src

#### client：客户端主文件



### resource(资源存放文件夹)

#### config：一般配置文件

定义连接服务器IP、端口等配置信息

### 

### build(CMake默认输出文件夹)



### ORP(orange协议)

#### ORPSET：传输配置

#### affair：客户端事务部分