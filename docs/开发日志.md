# 开发日志

## 10.01

早上中午研究题目，查资料，写设计文档。
下午研究大型C语言项目目录结构与CMake配置，commit message规范，完善设计，但对项目结构还是有点存疑。
晚上研究字节流，Linux环境socket编程，序列化与反序列化，Linux环境正则表达式，大概有了点方向，最后写了一点点socket

## 10.02

项目推进：

1. socket就绪
2. 初步建立ORP协议SDS数据包打包流程
3. 推进命令解释器进度
4. 初步建立请求数据的序列化
5. 完善SDS
6. 完善架构

遇到的技术难点与新想法：

1. 在请求字节流的生成与传输过程中，如何改造数据包结构、序列化与反序列化流程，使其将来能兼容任意新数据类型，实现好的可扩展性？
2. 或许可以在ORP协议中加入加解密模块，使字节流传输安全再上一层楼。
3. 复杂类型key,value参数如何实现安全、可区分的序列化？
4. (或许可以用MC联机的内网穿透器把ODB服务端端口穿透出去，客户端IP参数设为穿透器给的IP，然后我的电脑就能变真服务器了)
5. 对于config.h里定义的常量，应该可以加这么一个功能：把常量记录在一个txt文件里，再写一套c/h文件，每次运行时先调用里面的函数把.txt文件转换成.h文件或者以某种方式导入程序，这样用户就可以方便的通过记事本改变config里的配置参数。

## 10.03

项目推进：

1. **重大变更**：因原有ORP协议过于复杂，于下午2点起对现有函数进行重构、精简，开启可行新版本的构建，新版本暂命名为"ODB-Lite"
2. ODB-Lite客户端基本功能完成且可用，事务仍待实现
3. ODB-Lite服务端命令接收、解析部分完成，但未经测试
4. ODB-Lite加入基本HashTable与HashTable硬盘读写，但业务接口部分未完成

学习到的新知识：

1. 可以以shell为桥梁实现多语言开发
2. 正确的客户端与服务端功能思路
3. NoSQL的背景、概念、优缺点、存储方式、市面主流NoSQL。
4. 键值对存储大致思路

## 10.04

项目推进：

1. 完成SDS类型set,get,delete
2. 完成SAVE，RGSAVE
3. 完成客户端事务存包部分
4. 大致完成save(a,b)所需的单独线程数据变化监视器API，但仍需加锁以确保线程安全。

学习到的新知识：

1. C语言子进程创建
2. C语言线程创建、传参、锁的使用、结束机制

## 10.05

项目推进:

1. 采用djb2哈希函数，修改哈希表初始大小为质数，修复快照重复键值对问题。
2. 完成自动保存线程，引入互斥锁机制，修复传入参数包段错误，完成save(a,b)命令，同时将a,b作为配置信息存入快照，每次从最新快照启动时将会自动检查a,b来确定是否启用自动保存。
3. 采取格式化SDS的形式存储复杂数据类型，格式类似python打印信息，当执行类型特定命令时，将会解析格式化SDS得到原数据结构。若使用get()命令，将会返回格式化SDS，不进行解析。
4. 支持列表值类型，完成addl，addr，lindex命令
5. 支持哈希表值类型，完成hset，hget，另外添加了hdel命令

## 10.06

1. 开始做事务，对从命令接收到实现的过程做了更加仔细的封装，事务先把原哈希表复制一份独立的副本出来，要是事务执行成功了再用副本覆盖原哈希表。
2. 发现一个非常紧要的问题：多行命令连续发送会黏包?!，原来要做orange协议的意义就在这里吗?!
3. 疯狂重构，把跟通信无关的东西都从orange协议里面移了出去，把目录结构梳理了一遍，改了CMakeList
4. 做事务模块，客户端与服务端的都在改。
5. 然后一天在被Segmentation Fault支配的恐惧下结束了

## 10.07

白天工训没办法，晚上狂修Segmentation Fault和各种bug

## 10.08

1. 早上跑通了事务，自动事务提交也弄好了
2. 并发没时间做得更仔细，简单把事务处理函数改成了线程函数，在调用原数据库哈希表的地方上了互斥锁，然后跑通了，虽然我不确定真正的并发情形下会发生什么
3. 中午和下午敲各种md

